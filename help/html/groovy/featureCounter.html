<html>
<!--
 * Jalview - A Sequence Alignment Editor and Viewer (2.10.1)
 * Copyright (C) 2016 The Jalview Authors
 * 
 * This file is part of Jalview.
 * 
 * Jalview is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License 
 * as published by the Free Software Foundation, either version 3
 * of the License, or (at your option) any later version.
 *  
 * Jalview is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty 
 * of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
 * PURPOSE.  See the GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with Jalview.  If not, see <http://www.gnu.org/licenses/>.
 * The Jalview Authors are detailed in the 'AUTHORS' file.
 -->
<head>
<title>Extending Jalview with Groovy - Feature Counter Example</title>
</head>
<body>
  <p>
    <strong>Extending Jalview with Groovy - A customisable
      feature counter</strong><br /> <br />The groovy script below shows how to
    add a new calculation track to a Jalview alignment window.
  </p>
  <p>As currently written, it will add two tracks to a protein
    alignment view which count Pfam features in each column, and ones
    where a charge residue also occur.</p>
  <p>To try it for yourself:</p>
  <ol>
    <li>Copy and paste it into the groovy script console</li>
    <li>Load the example Feredoxin project (the one that opens by
      default when you first launched Jalview)</li>
    <li>Select <strong>Calculations&#8594;Execute Groovy
        Script</strong> from the alignment window's menu bar to run the script on
      the current view.
    </li>
  </ol>
  <em><a
    href="http://www.jalview.org/examples/groovy/featureCounter.groovy">http://www.jalview.org/examples/groovy/featureCounter.groovy</a>
    - rendered with <a href="http://hilite.me">hilite.me</a></em>
  <!-- HTML generated using hilite.me -->
  <div
    style="background: #ffffff; overflow: auto; width: auto; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
    <pre style="margin: 0; line-height: 125%">
<span style="color: #888888">/*</span>
<span style="color: #888888"> * Jalview - A Sequence Alignment Editor and Viewer (Version 2.10)</span>
<span style="color: #888888"> * Copyright (C) 2016 The Jalview Authors</span>
<span style="color: #888888"> * </span>
<span style="color: #888888"> * This file is part of Jalview.</span>
<span style="color: #888888"> * </span>
<span style="color: #888888"> * Jalview is free software: you can redistribute it and/or</span>
<span style="color: #888888"> * modify it under the terms of the GNU General Public License </span>
<span style="color: #888888"> * as published by the Free Software Foundation, either version 3</span>
<span style="color: #888888"> * of the License, or (at your option) any later version.</span>
<span style="color: #888888"> *  </span>
<span style="color: #888888"> * Jalview is distributed in the hope that it will be useful, but </span>
<span style="color: #888888"> * WITHOUT ANY WARRANTY; without even the implied warranty </span>
<span style="color: #888888"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR </span>
<span style="color: #888888"> * PURPOSE.  See the GNU General Public License for more details.</span>
<span style="color: #888888"> * </span>
<span style="color: #888888"> * You should have received a copy of the GNU General Public License</span>
<span style="color: #888888"> * along with Jalview.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span style="color: #888888"> * The Jalview Authors are detailed in the &#39;AUTHORS&#39; file.</span>
<span style="color: #888888"> */</span>
 
<span style="color: #008800; font-weight: bold">import</span> <span
        style="color: #0e84b5; font-weight: bold">jalview.workers.FeatureCounterI</span><span
        style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span
        style="color: #0e84b5; font-weight: bold">jalview.workers.AlignmentAnnotationFactory</span><span
        style="color: #333333">;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * Example script that registers two alignment annotation calculators</span>
<span style="color: #888888"> * - one that counts residues in a column with Pfam annotation</span>
<span style="color: #888888"> * - one that counts only charged residues with Pfam annotation</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * To try:</span>
<span style="color: #888888"> * 1. load uniref50.fa from the examples folder</span>
<span style="color: #888888"> * 2. load features onto it from from examples/exampleFeatures.txt</span>
<span style="color: #888888"> * 3. Open this script in the Groovy console.</span>
<span style="color: #888888"> * 4. Either execute this script from the console, or via Calculate-&gt;Run Groovy Script</span>
<span style="color: #888888"> </span>
<span style="color: #888888"> * To explore further, try changing this script to count other kinds of occurrences of </span>
<span style="color: #888888"> * residue and sequence features at columns in an alignment.</span>
<span style="color: #888888"> */</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * A closure that returns true for any Charged residue</span>
<span style="color: #888888"> */</span>
<span style="color: #333399; font-weight: bold">def</span> isCharged <span
        style="color: #333333">=</span> <span style="color: #333333">{</span> residue <span
        style="color: #333333">-&gt;</span>
    <span style="color: #008800; font-weight: bold">switch</span><span
        style="color: #333333">(</span>residue<span
        style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">case</span> <span
        style="color: #333333">[</span><span
        style="background-color: #fff0f0">&#39;D&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;d&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;E&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;e&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;H&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;h&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;K&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;k&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;R&#39;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&#39;r&#39;</span><span
        style="color: #333333">]:</span>
            <span style="color: #008800; font-weight: bold">return</span> <span
        style="color: #008800; font-weight: bold">true</span>
    <span style="color: #333333">}</span>
    <span style="color: #008800; font-weight: bold">false</span>
<span style="color: #333333">}</span> 

<span style="color: #888888">/*</span>
<span style="color: #888888"> * A closure that returns 1 if sequence features include type &#39;Pfam&#39;, else 0</span>
<span style="color: #888888"> * Argument should be a list of SequenceFeature </span>
<span style="color: #888888"> */</span>
<span style="color: #333399; font-weight: bold">def</span> hasPfam <span
        style="color: #333333">=</span> <span style="color: #333333">{</span> features <span
        style="color: #333333">-&gt;</span> 
    <span style="color: #008800; font-weight: bold">for</span> <span
        style="color: #333333">(</span>sf <span
        style="color: #008800; font-weight: bold">in</span> features<span
        style="color: #333333">)</span>
    <span style="color: #333333">{</span>
        <span style="color: #888888">/*</span>
<span style="color: #888888">         * Here we inspect the type of the sequence feature.</span>
<span style="color: #888888">         * You can also test sf.description, sf.score, sf.featureGroup,</span>
<span style="color: #888888">         * sf.strand, sf.phase, sf.begin, sf.end</span>
<span style="color: #888888">         * or sf.getValue(attributeName) for GFF &#39;column 9&#39; properties</span>
<span style="color: #888888">         */</span>
        <span style="color: #008800; font-weight: bold">if</span> <span
        style="color: #333333">(</span><span
        style="background-color: #fff0f0">&quot;Pfam&quot;</span><span
        style="color: #333333">.</span><span style="color: #0000CC">equals</span><span
        style="color: #333333">(</span>sf<span style="color: #333333">.</span><span
        style="color: #0000CC">type</span><span style="color: #333333">))</span>
        <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> <span
        style="color: #008800; font-weight: bold">true</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
    <span style="color: #008800; font-weight: bold">false</span>
<span style="color: #333333">}</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * Closure that computes an annotation based on </span>
<span style="color: #888888"> * presence of particular residues and features</span>
<span style="color: #888888"> * Parameters are</span>
<span style="color: #888888"> * - the name (label) for the alignment annotation</span>
<span style="color: #888888"> * - the description (tooltip) for the annotation</span>
<span style="color: #888888"> * - a closure (groovy function) that tests whether to include a residue</span>
<span style="color: #888888"> * - a closure that tests whether to increment count based on sequence features  </span>
<span style="color: #888888"> */</span>
<span style="color: #333399; font-weight: bold">def</span> getColumnCounter <span
        style="color: #333333">=</span> <span style="color: #333333">{</span> name<span
        style="color: #333333">,</span> desc<span style="color: #333333">,</span> acceptResidue<span
        style="color: #333333">,</span> acceptFeatures <span
        style="color: #333333">-&gt;</span>
    <span style="color: #333333">[</span>
     <span style="color: #997700; font-weight: bold">getName:</span> <span
        style="color: #333333">{</span> name <span
        style="color: #333333">},</span> 
     <span style="color: #997700; font-weight: bold">getDescription:</span> <span
        style="color: #333333">{</span> desc <span
        style="color: #333333">},</span>
     <span style="color: #997700; font-weight: bold">getMinColour:</span> <span
        style="color: #333333">{</span> <span style="color: #333333">[</span><span
        style="color: #0000DD; font-weight: bold">0</span><span
        style="color: #333333">,</span> <span
        style="color: #0000DD; font-weight: bold">255</span><span
        style="color: #333333">,</span> <span
        style="color: #0000DD; font-weight: bold">255</span><span
        style="color: #333333">]</span> <span style="color: #333333">},</span> <span
        style="color: #888888">// cyan</span>
     <span style="color: #997700; font-weight: bold">getMaxColour:</span> <span
        style="color: #333333">{</span> <span style="color: #333333">[</span><span
        style="color: #0000DD; font-weight: bold">0</span><span
        style="color: #333333">,</span> <span
        style="color: #0000DD; font-weight: bold">0</span><span
        style="color: #333333">,</span> <span
        style="color: #0000DD; font-weight: bold">255</span><span
        style="color: #333333">]</span> <span style="color: #333333">},</span> <span
        style="color: #888888">// blue</span>
     <span style="color: #997700; font-weight: bold">count:</span> 
         <span style="color: #333333">{</span> res<span
        style="color: #333333">,</span> feats <span
        style="color: #333333">-&gt;</span> 
            <span style="color: #333399; font-weight: bold">def</span> c <span
        style="color: #333333">=</span> <span
        style="color: #0000DD; font-weight: bold">0</span>
            <span style="color: #008800; font-weight: bold">if</span> <span
        style="color: #333333">(</span>acceptResidue<span
        style="color: #333333">.</span><span style="color: #0000CC">call</span><span
        style="color: #333333">(</span>res<span style="color: #333333">))</span>
            <span style="color: #333333">{</span>
                <span style="color: #008800; font-weight: bold">if</span> <span
        style="color: #333333">(</span>acceptFeatures<span
        style="color: #333333">.</span><span style="color: #0000CC">call</span><span
        style="color: #333333">(</span>feats<span style="color: #333333">))</span>
                <span style="color: #333333">{</span>
                    c<span style="color: #333333">++</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
            c
         <span style="color: #333333">}</span>
     <span style="color: #333333">]</span> <span
        style="color: #008800; font-weight: bold">as</span> FeatureCounterI
<span style="color: #333333">}</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * Define an annotation row that counts any residue with Pfam domain annotation</span>
<span style="color: #888888"> */</span>
<span style="color: #333399; font-weight: bold">def</span> pfamAnnotation <span
        style="color: #333333">=</span> getColumnCounter<span
        style="color: #333333">(</span><span
        style="background-color: #fff0f0">&quot;Pfam&quot;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&quot;Count of residues with Pfam domain annotation&quot;</span><span
        style="color: #333333">,</span> <span style="color: #333333">{</span><span
        style="color: #008800; font-weight: bold">true</span><span
        style="color: #333333">},</span> hasPfam<span
        style="color: #333333">)</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * Define an annotation row that counts charged residues with Pfam domain annotation</span>
<span style="color: #888888"> */</span>
<span style="color: #333399; font-weight: bold">def</span> chargedPfamAnnotation <span
        style="color: #333333">=</span> getColumnCounter<span
        style="color: #333333">(</span><span
        style="background-color: #fff0f0">&quot;Pfam charged&quot;</span><span
        style="color: #333333">,</span> <span
        style="background-color: #fff0f0">&quot;Count of charged residues with Pfam domain annotation&quot;</span><span
        style="color: #333333">,</span> isCharged<span
        style="color: #333333">,</span> hasPfam<span
        style="color: #333333">)</span>

<span style="color: #888888">/*</span>
<span style="color: #888888"> * Register the annotations</span>
<span style="color: #888888"> */</span>
AlignmentAnnotationFactory<span style="color: #333333">.</span><span
        style="color: #0000CC">newCalculator</span><span
        style="color: #333333">(</span>pfamAnnotation<span
        style="color: #333333">)</span> 
AlignmentAnnotationFactory<span style="color: #333333">.</span><span
        style="color: #0000CC">newCalculator</span><span
        style="color: #333333">(</span>chargedPfamAnnotation<span
        style="color: #333333">)</span>
</pre>
  </div>
</body>
</html>
